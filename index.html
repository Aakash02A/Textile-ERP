<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Textile ERP - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Body font */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
        }

        /* Custom styling for a professional look */
        .nav-link.active-link {
            background-color: #10b981; 
            color: white;
            box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.1), 0 2px 4px -2px rgba(16, 185, 129, 0.1);
        }
        .nav-link.active-link:hover {
             background-color: #059669;
        }
        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 0.75rem;
            font-weight: 500;
            color: #4b5563;
            transition: all 150ms ease-in-out;
        }
        .nav-link:hover:not(.active-link) {
            background-color: #f3f4f6;
            color: #10b981;
        }
        .nav-toggle {
            cursor: pointer;
            background-color: transparent;
            border: none;
            width: 100%;
            padding: 0.75rem;
        }
        .nav-submenu {
            transition: all 150ms ease-in-out;
        }
        .nav-submenu.show {
            display: block !important;
        }
        .nav-submenu.hidden {
            display: none;
        }
        .nav-sublink {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            color: #6b7280;
            text-decoration: none;
            transition: all 150ms ease-in-out;
        }
        .nav-sublink:hover {
            background-color: #f0fdf4;
            color: #10b981;
            padding-left: 1rem;
        }
        .toggle-icon {
            transition: transform 300ms ease-in-out;
        }
        .toggle-icon.rotate {
            transform: rotate(90deg);
        }
        .module-content {
            display: none;
        }
        .dashboard-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 1.5rem;
            transition: transform 0.2s;
        }
        .ml-card-icon {
            font-size: 24px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-bottom: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-smart': '#10b981', // Emerald 500
                        'secondary-data': '#3b82f6', // Blue 500
                        'accent-ml': '#f59e0b', // Amber 500
                        'risk-high': '#ef4444', // Red 500
                        'risk-low': '#10b981', // Emerald 500
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-50 flex h-screen overflow-hidden">

    <!-- Static Sidebar -->
    <aside id="sidebar" class="w-64 bg-white border-r border-gray-200 shadow-xl flex flex-col h-full">
        <!-- Sidebar Header with Logo -->
        <div class="p-6 border-b border-gray-100 flex items-center space-x-3 h-[70px]">
            <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-cyan-500 rounded-lg flex items-center justify-center shadow-md">
                <span class="text-white font-bold text-lg">TE</span>
            </div>
            <div>
                <h1 class="text-lg font-bold text-gray-900">Textile ERP</h1>
                <p class="text-xs text-gray-500">Enterprise Resource Planning</p>
            </div>
        </div>
        
        <!-- Navigation Menu -->
        <nav class="flex-grow p-4 space-y-2 overflow-y-auto">
            <div class="text-xs font-semibold uppercase text-gray-400 px-3 pt-3 pb-1">Intelligent Hub</div>
            <a href="#" data-module="ml_hub" class="nav-link active-link">
                <i class="fas fa-brain w-5 h-5"></i>
                <span>ML Intelligence Hub</span>
                <span class="ml-auto text-xs font-bold bg-white text-primary-smart px-2 py-0.5 rounded-full">AI</span>
            </a>
            <div class="text-xs font-semibold uppercase text-gray-400 px-3 pt-6 pb-1">Core Modules</div>
            <a href="#" data-module="erp_overview" class="nav-link">
                <i class="fas fa-tachometer-alt w-5 h-5"></i>
                <span>ERP Overview</span>
            </a>
            
            <!-- Procurement Module with Submenu -->
            <div class="nav-module-group">
                <button class="nav-link nav-toggle w-full text-left" data-module="procurement">
                    <i class="fas fa-handshake w-5 h-5"></i>
                    <span>Procurement & Suppliers</span>
                    <i class="fas fa-chevron-right w-4 h-4 ml-auto toggle-icon transition-transform duration-200"></i>
                </button>
                <div class="nav-submenu hidden pl-4 space-y-1">
                    <a href="#" data-operation="po-list" class="nav-sublink operation-link">
                        <i class="fas fa-list w-4 h-4"></i>
                        <span>PO List</span>
                    </a>
                    <a href="#" data-operation="create-po" class="nav-sublink operation-link">
                        <i class="fas fa-plus-circle w-4 h-4"></i>
                        <span>Create PO</span>
                    </a>
                    <a href="#" data-operation="supplier-list" class="nav-sublink operation-link">
                        <i class="fas fa-users w-4 h-4"></i>
                        <span>Supplier List</span>
                    </a>
                    <a href="#" data-operation="po-details" class="nav-sublink operation-link">
                        <i class="fas fa-file-details w-4 h-4"></i>
                        <span>PO Details</span>
                    </a>
                </div>
            </div>

            <!-- Inventory Module with Submenu -->
            <div class="nav-module-group">
                <button class="nav-link nav-toggle w-full text-left" data-module="inventory">
                    <i class="fas fa-warehouse w-5 h-5"></i>
                    <span>Inventory & Optimization</span>
                    <i class="fas fa-chevron-right w-4 h-4 ml-auto toggle-icon transition-transform duration-200"></i>
                </button>
                <div class="nav-submenu hidden pl-4 space-y-1">
                    <a href="#" data-operation="materials" class="nav-sublink operation-link">
                        <i class="fas fa-box w-4 h-4"></i>
                        <span>Materials</span>
                    </a>
                    <a href="#" data-operation="stock-dashboard" class="nav-sublink operation-link">
                        <i class="fas fa-chart-bar w-4 h-4"></i>
                        <span>Stock Dashboard</span>
                    </a>
                </div>
            </div>

            <!-- Production Module with Submenu -->
            <div class="nav-module-group">
                <button class="nav-link nav-toggle w-full text-left" data-module="production">
                    <i class="fas fa-cogs w-5 h-5"></i>
                    <span>Production & BOM</span>
                    <i class="fas fa-chevron-right w-4 h-4 ml-auto toggle-icon transition-transform duration-200"></i>
                </button>
                <div class="nav-submenu hidden pl-4 space-y-1">
                    <a href="#" data-operation="work-orders" class="nav-sublink operation-link">
                        <i class="fas fa-tasks w-4 h-4"></i>
                        <span>Work Orders</span>
                    </a>
                    <a href="#" data-operation="create-work-order" class="nav-sublink operation-link">
                        <i class="fas fa-plus-circle w-4 h-4"></i>
                        <span>Create Work Order</span>
                    </a>
                    <a href="#" data-operation="production-log" class="nav-sublink operation-link">
                        <i class="fas fa-book w-4 h-4"></i>
                        <span>Production Log</span>
                    </a>
                </div>
            </div>

            <!-- Quality Control Module with Submenu -->
            <div class="nav-module-group">
                <button class="nav-link nav-toggle w-full text-left" data-module="qc">
                    <i class="fas fa-check-circle w-5 h-5"></i>
                    <span>Quality Control</span>
                    <i class="fas fa-chevron-right w-4 h-4 ml-auto toggle-icon transition-transform duration-200"></i>
                </button>
                <div class="nav-submenu hidden pl-4 space-y-1">
                    <a href="#" data-operation="qc-form" class="nav-sublink operation-link">
                        <i class="fas fa-clipboard w-4 h-4"></i>
                        <span>QC Form</span>
                    </a>
                </div>
            </div>

            <!-- Sales Module with Submenu -->
            <div class="nav-module-group">
                <button class="nav-link nav-toggle w-full text-left" data-module="sales">
                    <i class="fas fa-shopping-cart w-5 h-5"></i>
                    <span>Sales & Orders</span>
                    <i class="fas fa-chevron-right w-4 h-4 ml-auto toggle-icon transition-transform duration-200"></i>
                </button>
                <div class="nav-submenu hidden pl-4 space-y-1">
                    <a href="#" data-operation="sales-orders" class="nav-sublink operation-link">
                        <i class="fas fa-shopping-bag w-4 h-4"></i>
                        <span>Sales Orders</span>
                    </a>
                    <a href="#" data-operation="create-sales-order" class="nav-sublink operation-link">
                        <i class="fas fa-plus-circle w-4 h-4"></i>
                        <span>Create Order</span>
                    </a>
                    <a href="#" data-operation="customers" class="nav-sublink operation-link">
                        <i class="fas fa-users w-4 h-4"></i>
                        <span>Customers</span>
                    </a>
                    <a href="#" data-operation="create-customer" class="nav-sublink operation-link">
                        <i class="fas fa-user-plus w-4 h-4"></i>
                        <span>Create Customer</span>
                    </a>
                </div>
            </div>

            <!-- Reports Module with Submenu -->
            <div class="nav-module-group">
                <button class="nav-link nav-toggle w-full text-left" data-module="reports">
                    <i class="fas fa-file-chart-line w-5 h-5"></i>
                    <span>Reports</span>
                    <i class="fas fa-chevron-right w-4 h-4 ml-auto toggle-icon transition-transform duration-200"></i>
                </button>
                <div class="nav-submenu hidden pl-4 space-y-1">
                    <a href="#" data-operation="reports-inventory" class="nav-sublink operation-link">
                        <i class="fas fa-chart-pie w-4 h-4"></i>
                        <span>Inventory Reports</span>
                    </a>
                    <a href="#" data-operation="reports-procurement" class="nav-sublink operation-link">
                        <i class="fas fa-chart-column w-4 h-4"></i>
                        <span>Procurement Reports</span>
                    </a>
                    <a href="#" data-operation="reports-production" class="nav-sublink operation-link">
                        <i class="fas fa-chart-line w-4 h-4"></i>
                        <span>Production Reports</span>
                    </a>
                    <a href="#" data-operation="reports-quality" class="nav-sublink operation-link">
                        <i class="fas fa-chart-bar w-4 h-4"></i>
                        <span>Quality Reports</span>
                    </a>
                    <a href="#" data-operation="reports-sales" class="nav-sublink operation-link">
                        <i class="fas fa-chart-area w-4 h-4"></i>
                        <span>Sales Reports</span>
                    </a>
                </div>
            </div>
        </nav>
        
        <!-- Sidebar Footer with User Profile -->
        <div class="p-4 border-t border-gray-100">
            <div class="flex items-center space-x-3 p-3 rounded-xl hover:bg-gray-100 transition duration-150 cursor-pointer">
                <div class="w-10 h-10 bg-gradient-to-r from-blue-400 to-cyan-400 rounded-full flex items-center justify-center text-white font-bold text-sm">
                    U
                </div>
                <div class="flex-1">
                    <p class="font-medium text-gray-800" id="userName">Administrator</p>
                    <p class="text-xs text-gray-500">Admin User</p>
                </div>
                <button class="relative p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition">
                    <i class="fas fa-bell w-5 h-5"></i>
                    <span class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"></span>
                </button>
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Page Header -->
        <header class="bg-white shadow-sm p-4 flex justify-between items-center h-[70px]">
            <div class="flex items-center space-x-4">
                <h1 class="text-3xl font-bold text-gray-800" id="page-title">ML Intelligence Hub</h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <input type="text" placeholder="Search modules, reports, or data..." 
                           class="py-2 pl-10 pr-4 border border-gray-300 rounded-lg focus:ring-primary-smart focus:border-primary-smart transition w-64" />
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 overflow-x-hidden overflow-y-auto p-4 md:p-8 space-y-8">
            <!-- ML Hub Content -->
            <section id="ml_hub_content" class="module-content">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">ML Intelligence Hub</h2> -->
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8" id="ml-summary-cards">
                    <div class="dashboard-card border-b-4 border-primary-smart">
                        <p class="text-sm font-medium text-gray-500">Demand Forecast Accuracy</p>
                        <p class="text-4xl font-extrabold text-primary-smart mt-2" id="df-accuracy">--</p>
                        <p class="text-xs text-gray-600 mt-2" id="df-model-info">Fetching...</p>
                    </div>
                    <div class="dashboard-card border-b-4 border-accent-ml">
                        <p class="text-sm font-medium text-gray-500">Inventory Optimization Score</p>
                        <p class="text-4xl font-extrabold text-accent-ml mt-2" id="io-score">--</p>
                        <p class="text-xs text-gray-600 mt-2" id="io-model-info">Fetching...</p>
                    </div>
                    <div class="dashboard-card border-b-4 border-risk-high">
                        <p class="text-sm font-medium text-gray-500">Predicted Supplier Risk</p>
                        <p class="text-4xl font-extrabold text-risk-high mt-2" id="sr-risk">--</p>
                        <p class="text-xs text-gray-600 mt-2" id="sr-model-info">Fetching...</p>
                    </div>
                    <div class="dashboard-card border-b-4 border-secondary-data">
                        <p class="text-sm font-medium text-gray-500">Automated Defect Rate</p>
                        <p class="text-4xl font-extrabold text-secondary-data mt-2" id="qc-defect-rate">--</p>
                        <p class="text-xs text-gray-600 mt-2" id="qc-model-info">Fetching...</p>
                    </div>
                </div>

                <div class="lg:grid lg:grid-cols-3 gap-8 mb-8">
                    <div class="lg:col-span-2 dashboard-card p-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Demand Forecast (SKU: CFF234)</h3>
                        <div class="h-80 bg-gray-50 p-4 rounded-lg flex items-center justify-center border border-dashed border-gray-300 mb-4">
                            <canvas id="demandForecastChart"></canvas>
                        </div>
                        <div class="p-4 bg-blue-50 border-l-4 border-secondary-data rounded-lg">
                            <p class="text-sm font-medium text-secondary-data mb-1">Dynamic API Insight (Action Required):</p>
                            <p class="text-base text-gray-700 font-semibold" id="dynamic-insight">Fetching actionable insight...</p>
                        </div>
                    </div>
                    
                    <div class="lg:col-span-1 dashboard-card p-6 mt-8 lg:mt-0">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Inventory Optimization</h3>
                        <p class="text-sm text-gray-500 mb-4">Top 3 RF recommendations:</p>
                        <ul id="inventory-list" class="space-y-3">
                            <li class="p-3 bg-yellow-50 rounded-lg">Loading items...</li>
                        </ul>
                        <button onclick="fetchInventoryOptimization(true)" class="w-full mt-6 bg-accent-ml text-white p-3 rounded-xl font-medium hover:bg-amber-600 transition duration-150 shadow-md">
                            Run Optimization & View Full Report
                        </button>
                    </div>
                </div>

                <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">ML Model Overview</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="dashboard-card flex flex-col items-center">
                        <div class="ml-card-icon" style="background: #3b82f6;">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="text-lg font-semibold mb-2">Demand Forecasting</div>
                        <div class="text-sm text-gray-500 mb-4">LSTM-based model for predicting future demand patterns.</div>
                        <button class="w-full bg-secondary-data text-white p-2 rounded-lg font-medium hover:bg-blue-600 transition">View Forecast</button>
                    </div>

                    <div class="dashboard-card flex flex-col items-center">
                        <div class="ml-card-icon" style="background: #10b981;">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="text-lg font-semibold mb-2">Inventory Optimization</div>
                        <div class="text-sm text-gray-500 mb-4">Random Forest Regression for optimal stock levels.</div>
                        <button class="w-full bg-primary-smart text-white p-2 rounded-lg font-medium hover:bg-emerald-600 transition">Optimize Now</button>
                    </div>

                    <div class="dashboard-card flex flex-col items-center">
                        <div class="ml-card-icon" style="background: #ef4444;">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="text-lg font-semibold mb-2">Defect Detection</div>
                        <div class="text-sm text-gray-500 mb-4">CNN/Logistic Regression for automated defect classification.</div>
                        <button onclick="showDefectData()" class="w-full bg-risk-high text-white p-2 rounded-lg font-medium hover:bg-red-600 transition">Analyze Quality</button>
                    </div>

                    <div class="dashboard-card flex flex-col items-center">
                        <div class="ml-card-icon" style="background: #f59e0b;">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="text-lg font-semibold mb-2">Supplier Scoring</div>
                        <div class="text-sm text-gray-500 mb-4">SVM for supplier performance prediction and evaluation.</div>
                        <button onclick="fetchSupplierRisk()" class="w-full bg-accent-ml text-white p-2 rounded-lg font-medium hover:bg-amber-600 transition">Score Suppliers</button>
                    </div>
                </div>
            </section>

            <!-- ERP Overview Content -->
            <section id="erp_overview_content" class="module-content">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">ERP Overview üìä</h2> -->
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="dashboard-card border-l-4 border-secondary-data">
                        <p class="text-sm font-medium text-gray-500">Active Work Orders</p>
                        <p class="text-3xl font-bold text-gray-900 mt-1">1,248</p>
                        <p class="text-xs text-green-600 mt-2"><i class="fas fa-arrow-up"></i> 12% from last month</p>
                    </div>
                    <div class="dashboard-card border-l-4 border-primary-smart">
                        <p class="text-sm font-medium text-gray-500">Current Stock Value</p>
                        <p class="text-3xl font-bold text-gray-900 mt-1">$2.84M</p>
                        <p class="text-xs text-red-600 mt-2"><i class="fas fa-arrow-down"></i> 5% from last month</p>
                    </div>
                    <div class="dashboard-card border-l-4 border-risk-high">
                        <p class="text-sm font-medium text-gray-500">Quality Defect Rate</p>
                        <p class="text-3xl font-bold text-gray-900 mt-1">2.4%</p>
                        <p class="text-xs text-red-600 mt-2"><i class="fas fa-arrow-up"></i> 0.3% from last month</p>
                    </div>
                    <div class="dashboard-card border-l-4 border-accent-ml">
                        <p class="text-sm font-medium text-gray-500">Open Sales Orders</p>
                        <p class="text-3xl font-bold text-gray-900 mt-1">34</p>
                        <p class="text-xs text-gray-600 mt-2">Avg. $75k per order</p>
                    </div>
                </div>

                <div class="dashboard-card p-6">
                    <div class="flex justify-between items-center mb-4 border-b pb-3">
                        <h3 class="text-xl font-semibold text-gray-800">Recent Production Orders</h3>
                        <select class="p-2 border border-gray-300 rounded-lg text-sm">
                            <option>All Status</option>
                            <option>Completed</option>
                            <option>Processing</option>
                            <option>Pending</option>
                        </select>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Deadline</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#PO-4821</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Cotton T-Shirt</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">5,000 units</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Nov 15, 2023</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Completed</span>
                                    </td>
                                </tr>
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#PO-4822</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Denim Jeans</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">2,500 units</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Nov 20, 2023</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">Processing</span>
                                    </td>
                                </tr>
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#PO-4823</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Polyester Jacket</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">1,800 units</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Nov 25, 2023</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Pending</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Other Module Contents -->
            <section id="procurement_content" class="module-content">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Procurement & Suppliers ü§ù</h2> -->
                <div class="p-8 dashboard-card border-l-4 border-indigo-500">
                    <p class="text-xl font-medium text-indigo-700 mb-4">Purchase Order (PO) Management & Risk</p>
                    <p class="text-gray-600">Manage supplier lifecycle, PO creation, and goods receipt. The ML Supplier Scoring model (SVM) is integrated here to flag high-risk suppliers before order placement.</p>
                    <p class="mt-4 text-sm text-gray-600 font-semibold">API Endpoint Example: POST /api/procurement/new_po</p>
                    <button class="mt-4 bg-indigo-500 text-white p-2 rounded-lg text-sm hover:bg-indigo-600 transition">Create New PO</button>
                </div>
            </section>

            <section id="inventory_content" class="module-content">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Inventory & Traceability üì¶</h2> -->
                <div class="p-8 dashboard-card border-l-4 border-yellow-500">
                    <p class="text-xl font-medium text-yellow-700 mb-4">Raw Material Stock and Batch Traceability</p>
                    <p class="text-gray-600">View real-time inventory levels, stock lot tracking, and warehouse locations. The **Random Forest Inventory Optimization** runs directly off this module's data, recommending optimal reorder points and quantities.</p>
                    <p class="mt-4 text-sm text-gray-600 font-semibold">API Endpoint Example: GET /api/inventory/stock_level?sku=RC-S1</p>
                    <button class="mt-4 bg-yellow-500 text-white p-2 rounded-lg text-sm hover:bg-yellow-600 transition">View Stock Lots</button>
                </div>
            </section>

            <section id="production_content" class="module-content">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Production & BOM ‚öôÔ∏è</h2>
                <div class="p-8 dashboard-card border-l-4 border-blue-500">
                    <p class="text-xl font-medium text-blue-700 mb-4">Work Order and Bill-of-Materials (BOM) Tracking</p>
                    <p class="text-gray-600">Manages production schedules, tracks work-in-progress (WIP), and defines product BOMs. Production targets are dynamically updated based on the **LSTM Demand Forecast** results.</p>
                    <p class="mt-4 text-sm text-gray-600 font-semibold">API Endpoint Example: PUT /api/production/update_status?wo_id=WO-045</p>
                    <button class="mt-4 bg-blue-500 text-white p-2 rounded-lg text-sm hover:bg-blue-600 transition">View Production Schedule</button>
                </div>
            </section>

            <section id="qc_content" class="module-content">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Quality Control ‚úÖ</h2> -->
                <div class="p-8 dashboard-card border-l-4 border-risk-high">
                    <p class="text-xl font-medium text-risk-high mb-4">Defect Logging and Automated Classification</p>
                    <p class="text-gray-600">Interface for logging defects, viewing images from the line, and consuming real-time classification results from the **CNN/Logistic Regression Defect Detection** ML model.</p>
                    <p class="mt-4 text-sm text-gray-600 font-semibold">API Endpoint Example: POST /api/qc/log_defect</p>
                    <button class="mt-4 bg-risk-high text-white p-2 rounded-lg text-sm hover:bg-red-600 transition">Log New Defect</button>
                </div>
            </section>

            <section id="sales_content" class="module-content">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Sales & Orders üí∞</h2> -->
                <div class="p-8 dashboard-card border-l-4 border-fuchsia-500">
                    <p class="text-xl font-medium text-fuchsia-700 mb-4">Order Management and Customer Feedback</p>
                    <p class="text-gray-600">Tracks customer orders and fulfillment rates. It heavily relies on the **Demand Forecasting ML** results to set sales quotas and prioritize high-demand product fulfillment.</p>
                    <p class="mt-4 text-sm text-gray-600 font-semibold">API Endpoint Example: GET /api/sales/customer_orders?status=pending</p>
                    <button class="mt-4 bg-fuchsia-500 text-white p-2 rounded-lg text-sm hover:bg-fuchsia-600 transition">Manage Sales Orders</button>
                </div>
            </section>

            <section id="reports_content" class="module-content">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Reports & Analytics üìä</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <div class="dashboard-card hover:shadow-lg transition duration-200 cursor-pointer" onclick="window.open('frontend/reports/reports-inventory.html')">
                        <div class="flex items-center mb-4">
                            <div class="ml-card-icon" style="background: #10b981; margin-bottom: 0;">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-lg font-semibold text-gray-800">Inventory Reports</h3>
                                <p class="text-xs text-gray-500">Stock levels & trends</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Track inventory movements, stock value, and warehouse utilization metrics.</p>
                        <button class="w-full bg-primary-smart text-white p-2 rounded-lg font-medium hover:bg-emerald-600 transition text-sm">View Report</button>
                    </div>

                    <div class="dashboard-card hover:shadow-lg transition duration-200 cursor-pointer" onclick="window.open('frontend/reports/reports-procurement.html')">
                        <div class="flex items-center mb-4">
                            <div class="ml-card-icon" style="background: #3b82f6; margin-bottom: 0;">
                                <i class="fas fa-chart-column"></i>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-lg font-semibold text-gray-800">Procurement Reports</h3>
                                <p class="text-xs text-gray-500">PO & supplier data</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Analyze purchase orders, supplier performance, and procurement costs.</p>
                        <button class="w-full bg-secondary-data text-white p-2 rounded-lg font-medium hover:bg-blue-600 transition text-sm">View Report</button>
                    </div>

                    <div class="dashboard-card hover:shadow-lg transition duration-200 cursor-pointer" onclick="window.open('frontend/reports/reports-production.html')">
                        <div class="flex items-center mb-4">
                            <div class="ml-card-icon" style="background: #f59e0b; margin-bottom: 0;">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-lg font-semibold text-gray-800">Production Reports</h3>
                                <p class="text-xs text-gray-500">Work orders & output</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Monitor production schedules, efficiency, and work order status.</p>
                        <button class="w-full bg-accent-ml text-white p-2 rounded-lg font-medium hover:bg-amber-600 transition text-sm">View Report</button>
                    </div>

                    <div class="dashboard-card hover:shadow-lg transition duration-200 cursor-pointer" onclick="window.open('frontend/reports/reports-quality.html')">
                        <div class="flex items-center mb-4">
                            <div class="ml-card-icon" style="background: #ef4444; margin-bottom: 0;">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-lg font-semibold text-gray-800">Quality Reports</h3>
                                <p class="text-xs text-gray-500">Defect & QC data</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Review defect rates, quality metrics, and compliance status.</p>
                        <button class="w-full bg-risk-high text-white p-2 rounded-lg font-medium hover:bg-red-600 transition text-sm">View Report</button>
                    </div>

                    <div class="dashboard-card hover:shadow-lg transition duration-200 cursor-pointer" onclick="window.open('frontend/reports/reports-sales.html')">
                        <div class="flex items-center mb-4">
                            <div class="ml-card-icon" style="background: #8b5cf6; margin-bottom: 0;">
                                <i class="fas fa-chart-area"></i>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-lg font-semibold text-gray-800">Sales Reports</h3>
                                <p class="text-xs text-gray-500">Revenue & orders</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Track sales performance, customer orders, and revenue trends.</p>
                        <button class="w-full bg-purple-600 text-white p-2 rounded-lg font-medium hover:bg-purple-700 transition text-sm">View Report</button>
                    </div>
                </div>
            </section>

            <!-- Embedded Operation Sections -->
            <!-- PO List -->
            <section data-operation-content="po-list" data-operation-title="Purchase Orders List" class="module-content" style="display: none;">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Purchase Orders üìã</h2> -->
                <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-8">
                    <div class="dashboard-card border-b-4 border-blue-500">
                        <p class="text-sm font-medium text-gray-500">Total POs</p>
                        <p class="text-4xl font-extrabold text-blue-600 mt-2">0</p>
                        <p class="text-xs text-gray-600 mt-2">Active orders</p>
                    </div>
                    <div class="dashboard-card border-b-4 border-green-500">
                        <p class="text-sm font-medium text-gray-500">Approved</p>
                        <p class="text-4xl font-extrabold text-green-600 mt-2">0</p>
                        <p class="text-xs text-gray-600 mt-2">Ready to receive</p>
                    </div>
                    <div class="dashboard-card border-b-4 border-yellow-500">
                        <p class="text-sm font-medium text-gray-500">Draft</p>
                        <p class="text-4xl font-extrabold text-yellow-600 mt-2">0</p>
                        <p class="text-xs text-gray-600 mt-2">Not submitted</p>
                    </div>
                    <div class="dashboard-card border-b-4 border-purple-500">
                        <p class="text-sm font-medium text-gray-500">Received</p>
                        <p class="text-4xl font-extrabold text-purple-600 mt-2">0</p>
                        <p class="text-xs text-gray-600 mt-2">Completed</p>
                    </div>
                    <div class="dashboard-card border-b-4 border-orange-500">
                        <p class="text-sm font-medium text-gray-500">Total Value</p>
                        <p class="text-3xl font-extrabold text-orange-600 mt-2">$0</p>
                        <p class="text-xs text-gray-600 mt-2">All orders</p>
                    </div>
                </div>

                <div class="dashboard-card p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-800">Recent POs</h3>
                        <button class="bg-primary-smart text-white px-4 py-2 rounded-lg hover:bg-emerald-600 transition">
                            <i class="fas fa-plus"></i> New PO
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">PO Number</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Supplier</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#PO-2024-001</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Textile Supplier Ltd</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dec 1, 2024</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">$15,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Approved</span>
                                    </td>
                                </tr>
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#PO-2024-002</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Fabric Wholesale</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dec 2, 2024</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">$8,500</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Draft</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Materials -->
            <section data-operation-content="materials" data-operation-title="Material Master" class="module-content" style="display: none;">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Materials üì¶</h2> -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="dashboard-card border-b-4 border-blue-500">
                        <p class="text-sm font-medium text-gray-500">Total Materials</p>
                        <p class="text-4xl font-extrabold text-blue-600 mt-2">0</p>
                    </div>
                    <div class="dashboard-card border-b-4 border-green-500">
                        <p class="text-sm font-medium text-gray-500">Low Stock</p>
                        <p class="text-4xl font-extrabold text-green-600 mt-2">0</p>
                    </div>
                    <div class="dashboard-card border-b-4 border-red-500">
                        <p class="text-sm font-medium text-gray-500">Out of Stock</p>
                        <p class="text-4xl font-extrabold text-red-600 mt-2">0</p>
                    </div>
                    <div class="dashboard-card border-b-4 border-purple-500">
                        <p class="text-sm font-medium text-gray-500">Total Value</p>
                        <p class="text-3xl font-extrabold text-purple-600 mt-2">$0K</p>
                    </div>
                </div>

                <div class="dashboard-card p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-800">Material Inventory</h3>
                        <button class="bg-primary-smart text-white px-4 py-2 rounded-lg hover:bg-emerald-600 transition">
                            <i class="fas fa-plus"></i> Add Material
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Material Code</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Quantity</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Unit Price</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">MAT-001</td>
                                    <td class="px-6 py-4 text-sm text-gray-700">Premium Cotton Fabric</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">500 m</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold">$12/m</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">In Stock</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Other operation sections (shortened for brevity) -->
            <section data-operation-content="create-po" data-operation-title="Create Purchase Order" class="module-content" style="display: none;">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Create Purchase Order</h2> -->
                <div class="dashboard-card p-6">
                    <p class="text-gray-600 mb-4">Create PO Form - Coming Soon</p>
                </div>
            </section>

            <section data-operation-content="supplier-list" data-operation-title="Supplier List" class="module-content" style="display: none;">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Supplier Management</h2> -->
                <div class="dashboard-card p-6">
                    <p class="text-gray-600 mb-4">Supplier List - Coming Soon</p>
                </div>
            </section>

            <section data-operation-content="stock-dashboard" data-operation-title="Stock Dashboard" class="module-content" style="display: none;">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Stock Dashboard</h2> -->
                <div class="dashboard-card p-6">
                    <p class="text-gray-600 mb-4">Stock Dashboard - Coming Soon</p>
                </div>
            </section>

            <section data-operation-content="work-orders" data-operation-title="Work Orders" class="module-content" style="display: none;">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Work Orders ‚öôÔ∏è</h2> -->
                <div class="dashboard-card p-6">
                    <p class="text-gray-600 mb-4">Work Orders - Coming Soon</p>
                </div>
            </section>

            <section data-operation-content="create-work-order" data-operation-title="Create Work Order" class="module-content" style="display: none;">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Create Work Order</h2> -->
                <div class="dashboard-card p-6">
                    <p class="text-gray-600 mb-4">Create Work Order Form - Coming Soon</p>
                </div>
            </section>

            <section data-operation-content="production-log" data-operation-title="Production Log" class="module-content" style="display: none;">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Production Log</h2> -->
                <div class="dashboard-card p-6">
                    <p class="text-gray-600 mb-4">Production Log - Coming Soon</p>
                </div>
            </section>

            <section data-operation-content="qc-form" data-operation-title="Quality Control Form" class="module-content" style="display: none;">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Quality Control Form ‚úÖ</h2> -->
                <div class="dashboard-card p-6">
                    <p class="text-gray-600 mb-4">QC Form - Coming Soon</p>
                </div>
            </section>

            <section data-operation-content="sales-orders" data-operation-title="Sales Orders" class="module-content" style="display: none;">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Sales Orders üõí</h2> -->
                <div class="dashboard-card p-6">
                    <p class="text-gray-600 mb-4">Sales Orders - Coming Soon</p>
                </div>
            </section>

            <section data-operation-content="create-sales-order" data-operation-title="Create Sales Order" class="module-content" style="display: none;">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Create Sales Order</h2> -->
                <div class="dashboard-card p-6">
                    <p class="text-gray-600 mb-4">Create Sales Order Form - Coming Soon</p>
                </div>
            </section>

            <section data-operation-content="customers" data-operation-title="Customer Management" class="module-content" style="display: none;">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Customers</h2> -->
                <div class="dashboard-card p-6">
                    <p class="text-gray-600 mb-4">Customer List - Coming Soon</p>
                </div>
            </section>

            <section data-operation-content="create-customer" data-operation-title="Create Customer" class="module-content" style="display: none;">
                <!-- <h2 class="text-3xl font-bold text-gray-800 mb-6">Create Customer</h2> -->
                <div class="dashboard-card p-6">
                    <p class="text-gray-600 mb-4">Create Customer Form - Coming Soon</p>
                </div>
            </section>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const API_BASE_URL = 'http://127.0.0.1:5000/api/ml'; // Flask API base URL
        
        // --- Navigation Logic ---
        const moduleMap = {
            'ml_hub': { title: 'ML Intelligence Hub', contentId: 'ml_hub_content' },
            'erp_overview': { title: 'ERP Overview', contentId: 'erp_overview_content' },
            'procurement': { title: 'Procurement & Suppliers', contentId: 'procurement_content' },
            'inventory': { title: 'Inventory & Optimization', contentId: 'inventory_content' },
            'production': { title: 'Production & BOM', contentId: 'production_content' },
            'qc': { title: 'Quality Control', contentId: 'qc_content' },
            'sales': { title: 'Sales & Orders', contentId: 'sales_content' },
            'reports': { title: 'Reports', contentId: 'reports_content' }
        };
        
        const pageTitle = document.getElementById('page-title');
        const contentSections = document.querySelectorAll('.module-content');
        const navLinks = document.querySelectorAll('.nav-link');
        const navToggles = document.querySelectorAll('.nav-toggle');
        let demandChart;

        // --- Submenu Toggle Functionality ---
        navToggles.forEach(toggle => {
            toggle.addEventListener('click', (e) => {
                e.preventDefault();
                const moduleGroup = toggle.closest('.nav-module-group');
                const submenu = moduleGroup.querySelector('.nav-submenu');
                const toggleIcon = toggle.querySelector('.toggle-icon');
                
                // Close other submenus
                document.querySelectorAll('.nav-submenu').forEach(menu => {
                    if (menu !== submenu) {
                        menu.classList.add('hidden');
                        menu.classList.remove('show');
                        const icon = menu.closest('.nav-module-group').querySelector('.toggle-icon');
                        icon.classList.remove('rotate');
                    }
                });
                
                // Toggle current submenu
                submenu.classList.toggle('hidden');
                submenu.classList.toggle('show');
                toggleIcon.classList.toggle('rotate');
            });
        });

        function switchModule(moduleId) {
            navLinks.forEach(link => link.classList.remove('active-link'));
            const activeLink = document.querySelector(`[data-module="${moduleId}"]`);
            if (activeLink && !activeLink.classList.contains('nav-toggle')) {
                activeLink.classList.add('active-link');
            }

            contentSections.forEach(section => section.style.display = 'none');
            const moduleInfo = moduleMap[moduleId];
            if (moduleInfo) {
                const activeContent = document.getElementById(moduleInfo.contentId);
                if (activeContent) activeContent.style.display = 'block';
                pageTitle.textContent = moduleInfo.title;
            }

            // Trigger real API data fetch on the ML Hub load
            if (moduleId === 'ml_hub') {
                fetchAllMLData();
            }
        }

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const moduleId = e.currentTarget.getAttribute('data-module');
                if (moduleId) switchModule(moduleId);
            });
        });

        // --- Operation Link Handlers (for embedded operations) ---
        const operationLinks = document.querySelectorAll('.operation-link');
        operationLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const operation = e.currentTarget.getAttribute('data-operation');
                if (operation) loadOperation(operation);
            });
        });

        function loadOperation(operationId) {
            // Hide all module contents and operation contents
            contentSections.forEach(section => section.style.display = 'none');
            document.querySelectorAll('[data-operation-content]').forEach(el => el.style.display = 'none');
            
            // Show the requested operation
            const operationContent = document.querySelector(`[data-operation-content="${operationId}"]`);
            if (operationContent) {
                operationContent.style.display = 'block';
                pageTitle.textContent = operationContent.getAttribute('data-operation-title');
                window.scrollTo(0, 0);
            }
        }

        // Initialize to the default module
        switchModule('ml_hub');

        // --- Core ML Data Fetching Functions ---

        async function fetchMLSummaryCards() {
            try {
                // 1. Demand Forecast
                const dfResponse = await fetch(`${API_BASE_URL}/demand_forecast`);
                const dfData = await dfResponse.json();
                document.getElementById('df-accuracy').textContent = dfData.accuracy;
                document.getElementById('df-model-info').textContent = `Model: ${dfData.model_type} (${dfData.surge} trend)`;

                // 2. Inventory Optimization (Score is generated here for mock purpose)
                document.getElementById('io-score').textContent = 'B+';
                document.getElementById('io-model-info').textContent = 'RF Regression Metric';

                // 3. Supplier Risk
                const srResponse = await fetch(`${API_BASE_URL}/supplier_risk`);
                const srData = await srResponse.json();
                document.getElementById('sr-risk').textContent = `${srData.risk_percentage} ${srData.risk_level}`;
                document.getElementById('sr-model-info').textContent = `Model: SVM (Score: ${srData.risk_score})`;

                // 4. Defect Classification
                const qcResponse = await fetch(`${API_BASE_URL}/defect_classification`);
                const qcData = await qcResponse.json();
                document.getElementById('qc-defect-rate').textContent = qcData.defect_rate;
                document.getElementById('qc-model-info').textContent = `Model Confidence: ${qcData.model_confidence}`;
            } catch (error) {
                console.error("Error fetching ML summary data:", error);
                document.getElementById('df-accuracy').textContent = 'API Error';
            }
        }

        async function fetchMLDemandForecast() {
            const insightElement = document.getElementById('dynamic-insight');
            insightElement.textContent = 'Contacting Python API for LSTM data...';

            try {
                const response = await fetch(`${API_BASE_URL}/demand_forecast`);
                const data = await response.json();

                insightElement.innerHTML = `‚ö†Ô∏è ${data.insight} (Last Update: ${data.timestamp})`;
            } catch (error) {
                insightElement.textContent = `Error: Could not connect to Flask API at ${API_BASE_URL}/demand_forecast. Is the server running?`;
                console.error(error);
            }
        }

        async function fetchInventoryOptimization(showAlert = false) {
            const inventoryList = document.getElementById('inventory-list');
            inventoryList.innerHTML = `<li class="p-3 bg-gray-50 rounded-lg text-gray-500 flex items-center"><i class="fas fa-spinner fa-spin mr-2"></i> Fetching Optimization Data...</li>`;
            
            try {
                const response = await fetch(`${API_BASE_URL}/inventory_optimization`);
                const data = await response.json();
                
                inventoryList.innerHTML = data.map(item => {
                    let badgeClass, statusColor;
                    if (item.status === 'CRITICAL LOW') {
                        badgeClass = 'bg-risk-high/10 text-risk-high';
                        statusColor = 'bg-red-50';
                    } else if (item.status === 'OVERSTOCK') {
                        badgeClass = 'bg-accent-ml/10 text-accent-ml';
                        statusColor = 'bg-yellow-50';
                    } else {
                        badgeClass = 'bg-primary-smart/10 text-primary-smart';
                        statusColor = 'bg-green-50';
                    }

                    return `
                        <li class="p-3 ${statusColor} rounded-lg flex justify-between items-center border border-gray-100">
                            <div>
                                <p class="font-medium text-gray-800">${item.sku}</p>
                                <p class="text-xs text-gray-500">RF Suggests: ${item.action}</p>
                            </div>
                            <span class="text-sm font-semibold px-3 py-1 rounded-full ${badgeClass}">${item.status}</span>
                        </li>
                    `;
                }).join('');

                if (showAlert) {
                    alert('Inventory Optimization Run Complete! See top 3 recommendations.');
                }
            } catch (error) {
                inventoryList.innerHTML = `<li class="p-3 bg-red-100 rounded-lg text-red-600">Error fetching inventory data.</li>`;
                console.error("Error fetching inventory optimization:", error);
            }
        }

        async function fetchSupplierRisk() {
            try {
                const response = await fetch(`${API_BASE_URL}/supplier_risk`);
                const data = await response.json();

                alert(`Supplier ${data.supplier_id} Risk Score: ${data.risk_score} (${data.risk_level})\n\nRecommendation: ${data.recommendation}`);
            } catch (error) {
                alert('Error fetching supplier risk data.');
                console.error("Error fetching supplier risk:", error);
            }
        }

        async function showDefectData() {
            try {
                const response = await fetch(`${API_BASE_URL}/defect_classification`);
                const data = await response.json();
                
                let defectAlert = `Quality Control Summary:\n\nTotal Defects Found: ${data.total_defects}\nDefect Rate: ${data.defect_rate}\nModel Confidence: ${data.model_confidence}\n\nClassification Breakdown:\n`;
                for (const [key, value] of Object.entries(data.classifications)) {
                    defectAlert += `- ${key}: ${value} instances\n`;
                }
                
                alert(defectAlert);
            } catch (error) {
                alert('Error fetching defect classification data.');
                console.error("Error fetching defect classification:", error);
            }
        }

        function fetchAllMLData() {
            fetchMLSummaryCards();
            fetchMLDemandForecast();
            fetchInventoryOptimization();
            renderDemandForecastChart();
        }

        // --- Chart.js Rendering Function ---

        function renderDemandForecastChart() {
            if (demandChart) {
                demandChart.destroy();
            }
            
            const ctx = document.getElementById('demandForecastChart').getContext('2d');
            const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov (F)', 'Dec (F)'];
            const actualData = [120, 150, 130, 180, 210, 240, 200, 230, 250, 280, 300, 320];
            const forecastData = [null, null, null, null, null, null, null, null, null, 280, 340, 380];
            
            demandChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Actual Sales (Units)',
                            data: actualData,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: true,
                            tension: 0.3,
                            pointRadius: 5,
                            pointBackgroundColor: '#3b82f6',
                            spanGaps: true
                        },
                        {
                            label: 'ML Forecast',
                            data: forecastData,
                            borderColor: '#f59e0b',
                            borderDash: [5, 5],
                            backgroundColor: 'transparent',
                            fill: false,
                            tension: 0.3,
                            pointRadius: 5,
                            pointBackgroundColor: '#f59e0b',
                            spanGaps: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Units Sold (x100)'
                            }
                        }
                    }
                }
            });
        }

        // Initialize
        fetchAllMLData();
    </script>
</body>
</html>