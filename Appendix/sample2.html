<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Textile ERP & ML Intelligence Hub (HTML/JS/Python Stack)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <style>
        /* Custom font and scrollbar styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        /* Common styles for module content */
        .module-content {
            display: none;
        }
        .dashboard-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
        }
        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 0.75rem;
            font-weight: 500;
            color: #4b5563;
            transition: background-color 150ms ease-in-out, color 150ms ease-in-out;
        }
        .nav-link:hover {
            background-color: #f3f4f6;
            color: #10b981;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-smart': '#10b981', // Emerald 500
                        'secondary-data': '#3b82f6', // Blue 500
                        'accent-ml': '#f59e0b', // Amber 500
                    }
                }
            }
        }
    </script>
</head>
<body class="flex h-screen overflow-hidden">

    <!-- Mobile Menu Toggle Button -->
    <button id="sidebarToggle" class="fixed top-4 left-4 z-50 p-2 rounded-full bg-primary-smart text-white lg:hidden shadow-lg">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar Navigation -->
    <aside id="sidebar" class="transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out w-64 bg-white border-r border-gray-200 shadow-xl fixed lg:relative z-40 flex flex-col h-full">
        
        <!-- Logo and Branding -->
        <div class="p-6 border-b border-gray-100 flex items-center space-x-2">
            <i class="fas fa-project-diagram w-8 h-8 text-primary-smart"></i>
            <span class="text-xl font-extrabold text-gray-800">Tex-Smart ERP</span>
        </div>

        <!-- Navigation Links -->
        <nav class="flex-grow p-4 space-y-2 overflow-y-auto">
            <div class="text-xs font-semibold uppercase text-gray-400 px-3 pt-3 pb-1">Dashboard & Planning</div>
            <a href="#" data-module="ml_hub" class="nav-link nav-active bg-primary-smart text-white shadow-md">
                <i class="fas fa-brain w-5 h-5"></i>
                <span>ML Intelligence Hub</span>
            </a>
            <a href="#" data-module="erp_overview" class="nav-link">
                <i class="fas fa-tachometer-alt w-5 h-5"></i>
                <span>ERP Overview</span>
            </a>

            <div class="text-xs font-semibold uppercase text-gray-400 px-3 pt-6 pb-1">Core Operations</div>
            <a href="#" data-module="procurement" class="nav-link">
                <i class="fas fa-handshake w-5 h-5"></i>
                <span>Procurement & Suppliers</span>
            </a>
            <a href="#" data-module="inventory" class="nav-link">
                <i class="fas fa-warehouse w-5 h-5"></i>
                <span>Inventory & Traceability</span>
            </a>
            <a href="#" data-module="production" class="nav-link">
                <i class="fas fa-cogs w-5 h-5"></i>
                <span>Production & BOM</span>
            </a>
            <a href="#" data-module="qc" class="nav-link">
                <i class="fas fa-check-circle w-5 h-5"></i>
                <span>Quality Control</span>
            </a>
            <a href="#" data-module="sales" class="nav-link">
                <i class="fas fa-shopping-cart w-5 h-5"></i>
                <span>Sales & Orders</span>
            </a>
        </nav>
        
        <!-- User/Settings Footer -->
        <div class="p-4 border-t border-gray-100">
            <a href="#" class="flex items-center space-x-3 p-3 rounded-xl hover:bg-gray-100 transition duration-150">
                <i class="fas fa-user-circle w-5 h-5 text-gray-500"></i>
                <div class="text-sm">
                    <p class="font-medium text-gray-800">API Key/Auth Status</p>
                    <p class="text-xs text-gray-500" id="auth-status">Authenticated</p>
                </div>
            </a>
        </div>
    </aside>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col overflow-hidden">
        
        <!-- Top Header Bar -->
        <header class="bg-white shadow-sm p-4 flex justify-between items-center z-30">
            <h1 class="text-2xl font-semibold text-gray-800 hidden md:block" id="page-title">ML Intelligence Hub</h1>
            <div class="flex items-center space-x-4">
                <button class="text-gray-500 hover:text-primary-smart p-2 rounded-full bg-gray-100 transition duration-150">
                    <i class="fas fa-bell w-5 h-5"></i>
                </button>
                <div class="flex items-center space-x-3">
                    <span class="text-sm font-medium text-gray-700 hidden sm:block">User: Admin</span>
                    <img class="h-10 w-10 rounded-full object-cover" src="https://placehold.co/40x40/3b82f6/ffffff?text=AD" alt="User Profile">
                </div>
            </div>
        </header>

        <!-- Page Content Container -->
        <main class="flex-1 overflow-x-hidden overflow-y-auto p-4 md:p-8 space-y-8">

            <!-- 1. ML Intelligence Hub Content -->
            <section id="ml_hub_content" class="module-content">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">ML Intelligence Hub</h2>
                
                <!-- Summary Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="dashboard-card border-l-4 border-primary-smart">
                        <p class="text-sm font-medium text-gray-500">Demand Forecast Accuracy</p>
                        <p class="text-3xl font-bold text-gray-900 mt-1">94.2%</p>
                        <p class="text-xs text-green-600 mt-2">LSTM Model Score</p>
                    </div>
                    <div class="dashboard-card border-l-4 border-accent-ml">
                        <p class="text-sm font-medium text-gray-500">Inventory Optimization Score</p>
                        <p class="text-3xl font-bold text-gray-900 mt-1">B+</p>
                        <p class="text-xs text-yellow-600 mt-2">RF Regression Metric</p>
                    </div>
                    <div class="dashboard-card border-l-4 border-red-500">
                        <p class="text-sm font-medium text-gray-500">Predicted Supplier Risk</p>
                        <p class="text-3xl font-bold text-gray-900 mt-1">12% High</p>
                        <p class="text-xs text-red-600 mt-2">SVM Model Risk</p>
                    </div>
                    <div class="dashboard-card border-l-4 border-secondary-data">
                        <p class="text-sm font-medium text-gray-500">Automated Defect Rate</p>
                        <p class="text-3xl font-bold text-gray-900 mt-1">0.87%</p>
                        <p class="text-xs text-red-600 mt-2">CNN/LR Classification</p>
                    </div>
                </div>

                <!-- Live Data & Actionable Insight -->
                <div class="lg:grid lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 dashboard-card p-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Demand Forecast (SKU: CFF234)</h3>
                        <div class="h-64 bg-gray-100 rounded-lg flex items-center justify-center border border-dashed border-gray-300 mb-4">
                            <p class="text-gray-400">Placeholder: D3.js or Chart.js Visualization of Demand vs. Prediction</p>
                        </div>
                        <div class="p-3 bg-blue-50 border-l-4 border-secondary-data rounded-lg">
                            <p class="text-sm font-medium text-secondary-data">Dynamic API Insight (Endpoint: `/api/ml/demand_forecast`):</p>
                            <p class="text-sm text-gray-700 font-semibold" id="dynamic-insight">Fetching actionable insight...</p>
                        </div>
                    </div>
                    
                    <div class="lg:col-span-1 dashboard-card p-6 mt-8 lg:mt-0">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Inventory Optimization</h3>
                        <p class="text-sm text-gray-500 mb-4">Top 3 RF recommendations:</p>
                        <ul id="inventory-list" class="space-y-3">
                            <!-- Dynamic items will be inserted here -->
                            <li class="p-3 bg-yellow-50 rounded-lg">Loading items...</li>
                        </ul>
                        <button onclick="fetchInventoryOptimization()" class="w-full mt-6 bg-primary-smart text-white p-3 rounded-xl font-medium hover:bg-emerald-600 transition duration-150 shadow-md">
                            Run Optimization & View Full Report
                        </button>
                    </div>
                </div>
            </section>

            <!-- 2. ERP Overview Content -->
            <section id="erp_overview_content" class="module-content">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">ERP Overview</h2>
                <div class="p-8 bg-white rounded-xl shadow-lg border-l-4 border-gray-400">
                    <p class="text-xl font-medium text-gray-700 mb-4">Architecture Summary (HTML/JS - Python API - PostgreSQL)</p>
                    <p class="text-gray-500">This module is the landing page for non-ML data. It shows aggregated, non-realtime KPIs fetched from the PostgreSQL database via your Python API (Endpoint: `/api/erp/kpis`).</p>
                    <p class="mt-4 text-sm text-gray-600">Placeholder for Production Line Status Grid and Financial Snapshots.</p>
                </div>
            </section>

            <!-- 3. Procurement & Suppliers Content -->
            <section id="procurement_content" class="module-content">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Procurement & Suppliers</h2>
                <div class="p-8 bg-white rounded-xl shadow-lg border-l-4 border-indigo-500">
                    <p class="text-xl font-medium text-indigo-700 mb-4">Purchase Order (PO) Management</p>
                    <p class="text-gray-600">This module manages supplier lifecycle, PO creation, and goods receipt. Data is stored in PostgreSQL (e.g., `suppliers` and `purchase_orders` tables).</p>
                    <p class="mt-4 text-sm text-gray-600">**API Endpoint Example:** POST `/api/procurement/new_po`</p>
                </div>
            </section>

            <!-- 4. Inventory & Traceability Content -->
            <section id="inventory_content" class="module-content">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Inventory & Traceability</h2>
                <div class="p-8 bg-white rounded-xl shadow-lg border-l-4 border-yellow-500">
                    <p class="text-xl font-medium text-yellow-700 mb-4">Raw Material Stock and Batch Traceability</p>
                    <p class="text-gray-600">Real-time inventory levels, stock lot tracking, and warehouse locations. Integrates directly with the Inventory Optimization ML service.</p>
                    <p class="mt-4 text-sm text-gray-600">**API Endpoint Example:** GET `/api/inventory/stock_level?sku=RC-S1`</p>
                </div>
            </section>

            <!-- 5. Production & BOM Content -->
            <section id="production_content" class="module-content">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Production & BOM</h2>
                <div class="p-8 bg-white rounded-xl shadow-lg border-l-4 border-blue-500">
                    <p class="text-xl font-medium text-blue-700 mb-4">Work Order and Bill-of-Materials (BOM) Tracking</p>
                    <p class="text-gray-600">Manages production schedules, tracks work-in-progress (WIP), and defines product BOMs. Data relies heavily on PostgreSQL for relational structure.</p>
                    <p class="mt-4 text-sm text-gray-600">**API Endpoint Example:** PUT `/api/production/update_status?wo_id=WO-045`</p>
                </div>
            </section>

            <!-- 6. Quality Control Content -->
            <section id="qc_content" class="module-content">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Quality Control</h2>
                <div class="p-8 bg-white rounded-xl shadow-lg border-l-4 border-red-500">
                    <p class="text-xl font-medium text-red-700 mb-4">Defect Logging and Automated Classification</p>
                    <p class="text-gray-600">Interface for logging defects, viewing images from the line, and consuming classification results from the CNN/Logistic Regression ML model.</p>
                    <p class="mt-4 text-sm text-gray-600">**API Endpoint Example:** POST `/api/qc/log_defect`</p>
                </div>
            </section>

            <!-- 7. Sales & Orders Content -->
            <section id="sales_content" class="module-content">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Sales & Orders</h2>
                <div class="p-8 bg-white rounded-xl shadow-lg border-l-4 border-fuchsia-500">
                    <p class="text-xl font-medium text-fuchsia-700 mb-4">Order Management and Customer Feedback</p>
                    <p class="text-gray-600">Tracks customer orders, fulfillment rates, and integrates with the Demand Forecasting ML results for setting sales quotas.</p>
                    <p class="mt-4 text-sm text-gray-600">**API Endpoint Example:** GET `/api/sales/customer_orders?status=pending`</p>
                </div>
            </section>

        </main>
    </div>
    
    <script>
        // --- Navigation and Module Switching Logic ---
        const moduleMap = {
            'ml_hub': { title: 'ML Intelligence Hub', contentId: 'ml_hub_content' },
            'erp_overview': { title: 'ERP Overview', contentId: 'erp_overview_content' },
            'procurement': { title: 'Procurement & Suppliers', contentId: 'procurement_content' },
            'inventory': { title: 'Inventory & Traceability', contentId: 'inventory_content' },
            'production': { title: 'Production & BOM', contentId: 'production_content' },
            'qc': { title: 'Quality Control', contentId: 'qc_content' },
            'sales': { title: 'Sales & Orders', contentId: 'sales_content' }
        };

        const pageTitle = document.getElementById('page-title');
        const contentSections = document.querySelectorAll('.module-content');
        const navLinks = document.querySelectorAll('.nav-link');
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');

        function switchModule(moduleId) {
            // 1. Update Navigation Styles
            navLinks.forEach(link => {
                link.classList.remove('nav-active', 'bg-primary-smart', 'text-white', 'shadow-md');
                link.classList.add('text-gray-600', 'hover:bg-gray-100');
            });
            const activeLink = document.querySelector(`[data-module="${moduleId}"]`);
            if (activeLink) {
                activeLink.classList.add('nav-active', 'bg-primary-smart', 'text-white', 'shadow-md');
                activeLink.classList.remove('text-gray-600', 'hover:bg-gray-100');
            }

            // 2. Update Content Visibility and Title
            contentSections.forEach(section => {
                section.style.display = 'none';
            });

            const moduleInfo = moduleMap[moduleId];
            if (moduleInfo) {
                const activeContent = document.getElementById(moduleInfo.contentId);
                if (activeContent) {
                    activeContent.style.display = 'block';
                }
                pageTitle.textContent = moduleInfo.title;
            }

            // 3. Close sidebar on mobile after navigation
            if (window.innerWidth < 1024) {
                sidebar.classList.add('-translate-x-full');
            }

            // 4. Trigger Dynamic Data Fetch (only for the active ML Hub)
            if (moduleId === 'ml_hub') {
                fetchMLDemandForecast();
                fetchInventoryOptimization();
            }
        }

        // Attach listeners to navigation links
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const moduleId = e.currentTarget.getAttribute('data-module');
                if (moduleId) {
                    switchModule(moduleId);
                }
            });
        });

        // Initialize to the default module
        switchModule('ml_hub');

        // --- Mock API Fetch Functions (Python Backend Simulation) ---

        /**
         * Simulates fetching ML insight from the Python API
         * Endpoint: /api/ml/demand_forecast
         */
        async function fetchMLDemandForecast() {
            const insightElement = document.getElementById('dynamic-insight');
            insightElement.textContent = 'Contacting Python API for LSTM data...';

            // Simulate network delay and data structure from Python
            await new Promise(resolve => setTimeout(resolve, 800));

            const mockData = {
                surge: "22%",
                production_adj: "+15%",
                product: "Premium Denim",
                timestamp: new Date().toLocaleTimeString()
            };

            // In a real application, you would use:
            /*
            const response = await fetch('/api/ml/demand_forecast');
            const data = await response.json();
            const surge = data.surge;
            const adjustment = data.production_adj;
            const product = data.product;
            */

            insightElement.innerHTML = `The model predicts a <span class="font-bold">${mockData.surge}</span> surge in Q4 orders for <span class="font-bold">${mockData.product}</span>. Adjust Production Capacity (WO-2025-01) by <span class="font-bold">${mockData.production_adj}</span> now to prepare. (Last Update: ${mockData.timestamp})`;
        }

        /**
         * Simulates fetching Inventory Optimization list from the Python API (PostgreSQL data)
         * Endpoint: /api/ml/inventory_optimization
         */
        async function fetchInventoryOptimization() {
            const inventoryList = document.getElementById('inventory-list');
            inventoryList.innerHTML = `<li class="p-3 bg-gray-50 rounded-lg text-gray-500 flex items-center"><i class="fas fa-spinner fa-spin mr-2"></i> Fetching PostgreSQL data...</li>`;

            await new Promise(resolve => setTimeout(resolve, 1200));

            const mockOptimizationData = [
                { sku: 'Raw Cotton (RC-S1)', action: 'CRITICAL LOW', suggestion: 'Safety Stock 8,000kg', statusClass: 'bg-red-200 text-red-700' },
                { sku: 'Silk Thread (ST-T4)', action: 'OVERSTOCK', suggestion: 'Min Stock 1,500 units', statusClass: 'bg-yellow-200 text-yellow-700' },
                { sku: 'Synthetic Dye (DYE-B)', action: 'Optimal', suggestion: 'Order 450 liters', statusClass: 'bg-green-200 text-primary-smart' },
            ];

            inventoryList.innerHTML = mockOptimizationData.map(item => `
                <li class="p-3 ${item.statusClass.includes('red') ? 'bg-red-50' : item.statusClass.includes('yellow') ? 'bg-yellow-50' : 'bg-green-50'} rounded-lg flex justify-between items-center">
                    <div>
                        <p class="font-medium text-gray-800">${item.sku}</p>
                        <p class="text-xs text-gray-500">RF Suggests: ${item.suggestion}</p>
                    </div>
                    <span class="text-sm font-semibold px-3 py-1 rounded-full ${item.statusClass}">${item.action}</span>
                </li>
            `).join('');
        }

        // --- Mobile Sidebar Toggle ---
        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
        });
        
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024) {
                sidebar.classList.remove('-translate-x-full');
            }
        });

    </script>
</body>
</html>